<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Calidad Taguchi</title>
    <!-- Esta es la línea que importa tu archivo CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- El resto de tus scripts y otras etiquetas van aquí -->
</head>
<body class="bg-gray-100">

    <!-- Main Container -->
    <div class="container bg-white rounded-xl shadow-lg mt-8 mb-8">

        <!-- Header -->
        <header class="text-center py-6 border-b border-gray-200">
            <h1 class="text-4xl font-extrabold text-gray-900">Análisis de Calidad según Taguchi</h1>
            <p class="mt-2 text-lg text-gray-600">Explorador Interactivo de la Función de Pérdida y Sumas de Cuadrados</p>
        </header>

        <!-- QLF Section -->
        <section class="py-8 border-b border-gray-200">
            <h2 class="text-2xl font-bold section-title text-gray-800">1. Explorador de la Función de Pérdida de Calidad (QLF)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <!-- QLF Controls -->
                <div class="space-y-4 p-4 rounded-lg bg-gray-50 border border-gray-200">
                    <div>
                        <label for="targetValue" class="block text-sm font-medium text-gray-700">Valor Nominal (N)</label>
                        <input type="number" id="targetValue" value="10" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="specLimit" class="block text-sm font-medium text-gray-700">Límite de Especificación (LES)</label>
                        <input type="number" id="specLimit" value="12" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="costAtLimit" class="block text-sm font-medium text-gray-700">Costo en el Límite de Especificación (C)</label>
                        <input type="number" id="costAtLimit" value="100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="pt-4">
                        <label for="observedValueSlider" class="block text-sm font-medium text-gray-700">Valor Observado (<span id="observedValueLabel">10</span>)</label>
                        <input type="range" id="observedValueSlider" min="8" max="12" step="0.1" value="10" class="mt-1 w-full">
                    </div>
                    <div class="text-center mt-4 p-4 bg-yellow-100 rounded-lg border border-yellow-200">
                        <p class="text-sm font-medium text-yellow-800">Pérdida de Calidad (L):</p>
                        <p id="lossValue" class="text-2xl font-bold text-yellow-900 mt-1">$0.00</p>
                    </div>
                </div>

                <!-- QLF Chart -->
                <div class="qlf-chart-container">
                    <canvas id="qlfChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Tabbed Interface for Sums of Squares -->
        <section class="py-8">
            <h2 class="text-2xl font-bold section-title text-gray-800">2. Descomposición de la Sumatoria de Cuadrados</h2>
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button data-tab="nominal-tab" class="tab-button active inline-flex items-center py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent">
                        Nominal es Mejor
                    </button>
                    <button data-tab="smaller-tab" class="tab-button inline-flex items-center py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent">
                        Menor es Mejor
                    </button>
                    <button data-tab="larger-tab" class="tab-button inline-flex items-center py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent">
                        Mayor es Mejor
                    </button>
                </nav>
            </div>
            
            <!-- Tab Contents -->
            <div id="nominal-tab" class="tab-content mt-4">
                <h3 class="text-xl font-semibold mb-4">Nominal es Mejor (NTB)</h3>
                <p class="text-gray-600 mb-4">El objetivo es que el valor de la característica de calidad alcance un valor nominal o ideal específico ($\text{N}$).</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- SST Formula and input -->
                    <div class="bg-blue-50 rounded-lg p-4 shadow-sm border border-blue-200">
                        <h4 class="text-lg font-medium text-blue-800">SST</h4>
                        <p class="text-gray-700 my-2 formula">$$\sum_{i=1}^{n} (y_i - N)^2$$</p>
                        <p class="text-sm text-gray-500">Suma total de cuadrados desde el valor nominal.</p>
                    </div>
                    <!-- SSe Formula and input -->
                    <div class="bg-red-50 rounded-lg p-4 shadow-sm border border-red-200">
                        <h4 class="text-lg font-medium text-red-800">SSe</h4>
                        <p class="text-gray-700 my-2 formula">$$\sum_{i=1}^{n} (y_i - \bar{y})^2$$</p>
                        <p class="text-sm text-gray-500">Suma de cuadrados del error, variación de las diferencias individuales.</p>
                    </div>
                    <!-- SSm Formula and input -->
                    <div class="bg-green-50 rounded-lg p-4 shadow-sm border border-green-200">
                        <h4 class="text-lg font-medium text-green-800">SSm</h4>
                        <p class="text-gray-700 my-2 formula">$$\frac{(\sum_{i=1}^{n} (y_i - N))^2}{n}$$</p>
                        <p class="text-sm text-gray-500">Suma de cuadrados de la media, variación de la media general.</p>
                    </div>
                </div>
                <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h4 class="font-bold mb-2">Calculadora de "Nominal es Mejor"</h4>
                    <label for="nominalData" class="block text-sm font-medium text-gray-700">Valores observados (y_i, separados por comas):</label>
                    <input type="text" id="nominalData" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" value="10.2, 9.8, 10.1, 9.9">
                    <label for="nominalTarget" class="block text-sm font-medium text-gray-700 mt-2">Valor Nominal (N):</label>
                    <input type="number" id="nominalTarget" value="10" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <button onclick="calculateNominal()" class="mt-4 w-full px-4 py-2 bg-gray-800 text-white font-bold rounded-md hover:bg-gray-700">Calcular</button>
                    <div class="mt-4 space-y-2 text-sm">
                        <p><span class="font-bold">SST:</span> <span id="nominal-SST">-</span></p>
                        <p><span class="font-bold">SSe:</span> <span id="nominal-SSe">-</span></p>
                        <p><span class="font-bold">SSm:</span> <span id="nominal-SSm">-</span></p>
                    </div>
                </div>
            </div>

            <div id="smaller-tab" class="tab-content hidden mt-4">
                <h3 class="text-xl font-semibold mb-4">Menor es Mejor (STB)</h3>
                <p class="text-gray-600 mb-4">El objetivo es minimizar el valor de la característica de calidad, idealmente hacia cero.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- SST Formula and input -->
                    <div class="bg-blue-50 rounded-lg p-4 shadow-sm border border-blue-200">
                        <h4 class="text-lg font-medium text-blue-800">SST</h4>
                        <p class="text-gray-700 my-2 formula">$$\sum_{i=1}^{n} (y_i)^2$$</p>
                        <p class="text-sm text-gray-500">Suma total de cuadrados desde cero.</p>
                    </div>
                    <!-- SSe Formula and input -->
                    <div class="bg-red-50 rounded-lg p-4 shadow-sm border border-red-200">
                        <h4 class="text-lg font-medium text-red-800">SSe</h4>
                        <p class="text-gray-700 my-2 formula">$$\sum_{i=1}^{n} (y_i - \bar{y})^2$$</p>
                        <p class="text-sm text-gray-500">Suma de cuadrados del error, variación de las diferencias individuales.</p>
                    </div>
                    <!-- SSm Formula and input -->
                    <div class="bg-green-50 rounded-lg p-4 shadow-sm border border-green-200">
                        <h4 class="text-lg font-medium text-green-800">SSm</h4>
                        <p class="text-gray-700 my-2 formula">$$\frac{(\sum_{i=1}^{n} y_i)^2}{n}$$</p>
                        <p class="text-sm text-gray-500">Suma de cuadrados de la media, variación de la media general.</p>
                    </div>
                </div>
                <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h4 class="font-bold mb-2">Calculadora de "Menor es Mejor"</h4>
                    <label for="smallerData" class="block text-sm font-medium text-gray-700">Valores observados (y_i, separados por comas):</label>
                    <input type="text" id="smallerData" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" value="0.1, 0.05, 0.15, 0.08">
                    <button onclick="calculateSmaller()" class="mt-4 w-full px-4 py-2 bg-gray-800 text-white font-bold rounded-md hover:bg-gray-700">Calcular</button>
                    <div class="mt-4 space-y-2 text-sm">
                        <p><span class="font-bold">SST:</span> <span id="smaller-SST">-</span></p>
                        <p><span class="font-bold">SSe:</span> <span id="smaller-SSe">-</span></p>
                        <p><span class="font-bold">SSm:</span> <span id="smaller-SSm">-</span></p>
                    </div>
                </div>
            </div>

            <div id="larger-tab" class="tab-content hidden mt-4">
                <h3 class="text-xl font-semibold mb-4">Mayor es Mejor (LTB)</h3>
                <p class="text-gray-600 mb-4">El objetivo es maximizar el valor de la característica de calidad, idealmente hacia el infinito.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- SST Formula and input -->
                    <div class="bg-blue-50 rounded-lg p-4 shadow-sm border border-blue-200">
                        <h4 class="text-lg font-medium text-blue-800">SST</h4>
                        <p class="text-gray-700 my-2 formula">$$\sum_{i=1}^{n} (\frac{1}{y_i})^2$$</p>
                        <p class="text-sm text-gray-500">Suma total de cuadrados desde cero, utilizando los recíprocos.</p>
                    </div>
                    <!-- SSe Formula and input -->
                    <div class="bg-red-50 rounded-lg p-4 shadow-sm border border-red-200">
                        <h4 class="text-lg font-medium text-red-800">SSe</h4>
                        <p class="text-gray-700 my-2 formula">$$\sum_{i=1}^{n} (\frac{1}{y_i} - \frac{\sum \frac{1}{y_i}}{n})^2$$</p>
                        <p class="text-sm text-gray-500">Suma de cuadrados del error, variación de las diferencias individuales.</p>
                    </div>
                    <!-- SSm Formula and input -->
                    <div class="bg-green-50 rounded-lg p-4 shadow-sm border border-green-200">
                        <h4 class="text-lg font-medium text-green-800">SSm</h4>
                        <p class="text-gray-700 my-2 formula">$$\frac{(\sum_{i=1}^{n} \frac{1}{y_i})^2}{n}$$</p>
                        <p class="text-sm text-gray-500">Suma de cuadrados de la media, variación de la media general.</p>
                    </div>
                </div>
                <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <h4 class="font-bold mb-2">Calculadora de "Mayor es Mejor"</h4>
                    <label for="largerData" class="block text-sm font-medium text-gray-700">Valores observados (y_i, separados por comas):</label>
                    <input type="text" id="largerData" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" value="50, 55, 48, 52">
                    <button onclick="calculateLarger()" class="mt-4 w-full px-4 py-2 bg-gray-800 text-white font-bold rounded-md hover:bg-gray-700">Calcular</button>
                    <div class="mt-4 space-y-2 text-sm">
                        <p><span class="font-bold">SST:</span> <span id="larger-SST">-</span></p>
                        <p><span class="font-bold">SSe:</span> <span id="larger-SSe">-</span></p>
                        <p><span class="font-bold">SSm:</span> <span id="larger-SSm">-</span></p>
                    </div>
                </div>
            </div>
        </section>

    </div>
    
    <!-- Script for interactivity and calculations -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        // Este código controla la interactividad de la página web.

        // ----------------------------------------------------
        // Lógica para el Explorador Interactivo de la QLF
        // ----------------------------------------------------
        
        // Obtener elementos del DOM para el QLF
        const targetValueInput = document.getElementById('targetValue');
        const specLimitInput = document.getElementById('specLimit');
        const costAtLimitInput = document.getElementById('costAtLimit');
        const observedValueSlider = document.getElementById('observedValueSlider');
        const observedValueLabel = document.getElementById('observedValueLabel');
        const lossValueDisplay = document.getElementById('lossValue');
        const qlfCanvas = document.getElementById('qlfChart');

        // Inicializar la gráfica de QLF
        const qlfChart = new Chart(qlfCanvas, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Función de Pérdida',
                    data: [],
                    borderColor: 'rgb(217, 119, 6)',
                    backgroundColor: 'rgba(217, 119, 6, 0.2)',
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Valor Observado (x)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Pérdida ($)'
                        },
                        beginAtZero: true
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return `Valor: ${context[0].label}`;
                            },
                            label: function(context) {
                                return `Pérdida: $${context.formattedValue}`;
                            }
                        }
                    }
                }
            }
        });

        // Función para calcular la pérdida de Taguchi (QLF) y actualizar la gráfica
        function updateQLF() {
            // Obtener valores de los inputs
            const N = parseFloat(targetValueInput.value);
            const LES = parseFloat(specLimitInput.value);
            const C = parseFloat(costAtLimitInput.value);
            const x = parseFloat(observedValueSlider.value);

            // Validar entradas
            if (isNaN(N) || isNaN(LES) || isNaN(C) || isNaN(x)) {
                console.error("Entradas no válidas para la QLF.");
                return;
            }

            // Calcular la constante de proporcionalidad 'k'
            const delta0 = LES - N;
            const k = C / (delta0 * delta0);

            // Calcular la pérdida para el valor observado 'x'
            const loss = k * Math.pow(x - N, 2);
            lossValueDisplay.textContent = `$${loss.toFixed(2)}`;
            
            // Actualizar el valor del slider
            observedValueLabel.textContent = x;

            // Generar datos para la gráfica
            const dataPoints = [];
            const labels = [];
            const start = N - delta0;
            const end = N + delta0;

            for (let i = start; i <= end; i += 0.1) {
                labels.push(i.toFixed(1));
                const lossValue = k * Math.pow(i - N, 2);
                dataPoints.push(lossValue);
            }

            qlfChart.data.labels = labels;
            qlfChart.data.datasets[0].data = dataPoints;
            qlfChart.update();
        }

        // Escuchar cambios en los inputs del QLF
        targetValueInput.addEventListener('input', updateQLF);
        specLimitInput.addEventListener('input', updateQLF);
        costAtLimitInput.addEventListener('input', updateQLF);
        observedValueSlider.addEventListener('input', updateQLF);
        
        // ----------------------------------------------------
        // Lógica para las pestañas de Tipos de Características
        // ----------------------------------------------------

        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Eliminar clase activa de todos los botones y contenidos
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.add('hidden'));

                // Agregar clase activa al botón y contenido seleccionados
                const tabId = button.dataset.tab;
                button.classList.add('active');
                document.getElementById(tabId).classList.remove('hidden');

                // Recargar MathJax para que las fórmulas se rendericen correctamente
                if (window.MathJax) {
                    MathJax.typeset();
                }
            });
        });

        // ----------------------------------------------------
        // Nuevas Fórmulas de la Descomposición de la Sumatoria de Cuadrados (SST, SSe, SSm)
        // A partir de la imagen proporcionada por el usuario.
        // ----------------------------------------------------

        /**
         * Calcula los componentes de la suma de cuadrados (SST, SSe, SSm)
         * para los tres tipos de características de calidad según Taguchi.
         * @param {string} type - El tipo de característica de calidad ('nominal', 'smaller', 'larger').
         * @param {Array<number>} data - Un array de valores observados (y_i).
         * @param {number} [target=0] - El valor nominal o ideal (y_0). Requerido para 'nominal'.
         * @returns {{SST: number, SSe: number, SSm: number}} Los valores calculados.
         */
        function calculateTaguchiSumsOfSquares(type, data, target = 0) {
            let sumOfSquaresTotal = 0;
            let sumOfSquaresError = 0;
            let sumOfSquaresMean = 0;
            let n = data.length;

            if (n === 0) {
                return { SST: 0, SSe: 0, SSm: 0 };
            }

            switch (type) {
                case 'nominal':
                    // Nominal es Mejor
                    let sumYiMinusY0 = 0;
                    let sumYi = 0;

                    for (let i = 0; i < n; i++) {
                        sumOfSquaresTotal += Math.pow(data[i] - target, 2);
                        sumYiMinusY0 += (data[i] - target);
                        sumYi += data[i];
                    }

                    const yBar = sumYi / n;
                    for (let i = 0; i < n; i++) {
                        sumOfSquaresError += Math.pow(data[i] - yBar, 2);
                    }
                    sumOfSquaresMean = Math.pow(sumYiMinusY0, 2) / n;
                    break;

                case 'smaller':
                    // Menor es Mejor
                    let sumYiSmaller = 0;

                    for (let i = 0; i < n; i++) {
                        sumOfSquaresTotal += Math.pow(data[i], 2);
                        sumYiSmaller += data[i];
                    }

                    const yBarSmaller = sumYiSmaller / n;
                    for (let i = 0; i < n; i++) {
                        sumOfSquaresError += Math.pow(data[i] - yBarSmaller, 2);
                    }
                    sumOfSquaresMean = Math.pow(sumYiSmaller, 2) / n;
                    break;

                case 'larger':
                    // Mayor es Mejor
                    let sumOneOverYi = 0;

                    for (let i = 0; i < n; i++) {
                        if (data[i] !== 0) {
                            sumOfSquaresTotal += Math.pow(1 / data[i], 2);
                            sumOneOverYi += (1 / data[i]);
                        }
                    }
                    
                    const oneOverYBar = sumOneOverYi / n;
                    for (let i = 0; i < n; i++) {
                        if (data[i] !== 0) {
                            sumOfSquaresError += Math.pow((1 / data[i]) - oneOverYBar, 2);
                        }
                    }
                    sumOfSquaresMean = Math.pow(sumOneOverYi, 2) / n;
                    break;

                default:
                    console.error("Tipo de característica no válido.");
                    break;
            }

            return {
                SST: sumOfSquaresTotal,
                SSe: sumOfSquaresError,
                SSm: sumOfSquaresMean
            };
        }
        
        // Funciones para manejar los clics de los botones de cálculo
        function calculateNominal() {
            const dataInput = document.getElementById('nominalData').value;
            const target = parseFloat(document.getElementById('nominalTarget').value);
            const data = dataInput.split(',').map(Number);
            
            const results = calculateTaguchiSumsOfSquares('nominal', data, target);
            
            document.getElementById('nominal-SST').textContent = results.SST.toFixed(4);
            document.getElementById('nominal-SSe').textContent = results.SSe.toFixed(4);
            document.getElementById('nominal-SSm').textContent = results.SSm.toFixed(4);
        }

        function calculateSmaller() {
            const dataInput = document.getElementById('smallerData').value;
            const data = dataInput.split(',').map(Number);
            
            const results = calculateTaguchiSumsOfSquares('smaller', data);
            
            document.getElementById('smaller-SST').textContent = results.SST.toFixed(4);
            document.getElementById('smaller-SSe').textContent = results.SSe.toFixed(4);
            document.getElementById('smaller-SSm').textContent = results.SSm.toFixed(4);
        }

        function calculateLarger() {
            const dataInput = document.getElementById('largerData').value;
            const data = dataInput.split(',').map(Number);
            
            const results = calculateTaguchiSumsOfSquares('larger', data);
            
            document.getElementById('larger-SST').textContent = results.SST.toFixed(4);
            document.getElementById('larger-SSe').textContent = results.SSe.toFixed(4);
            document.getElementById('larger-SSm').textContent = results.SSm.toFixed(4);
        }

        // Inicializar la página al cargar
        window.onload = function() {
            updateQLF();
            // Cargar MathJax en la pestaña inicial
            if (window.MathJax) {
                MathJax.typeset();
            }
        };
    </script>
</body>
</html>
